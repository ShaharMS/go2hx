import TestAdapterMacro.assert;
import _testadapter.data.TestResults;
import sys.io.File;
import sys.thread.Mutex;

final path = Sys.getCwd();
var completionServer:sys.io.Process;
final completionPort = 4000 + Std.random(200);
var results = null;
var testsLeft:Int = 0;
var testsTotal:Int = 0;
var tests:Array<Data> = [];
typedef Data = {args:Array<String>, data:Dynamic};

function main() {
	Util.deleteDirectoryRecursively("export");
	sys.FileSystem.createDirectory("export");
	TestResults.clear(path);
	results = new TestResults(path);
	completionServer = new sys.io.Process('haxe --wait $completionPort');
	Main.setup(0, 4);
	Main.onComplete = complete;
	test("go", "./go/test/", goList, [], 6 + 8 - 2);
	test("yaegi", "./yaegi/_test/", yaegiList, [
		"assign11", // expect error
		"assign12", // expect error
		"assign15", // expect error
		"bad0", // expect error
		"const9", // expect error
		"export1", // non main package
		"export0", // non main package
		"for7", // expect error
		"fun21", // expect error
		"fun22", // expect error
		"fun23", // expect error
		"fun24", // expect error
		"fun25", // expect error
		"if2", // expect error
		"import6", // expect error
		"init1", // expect error
		"io0", // uses random number
		"issue-1093", // expect error
		"op1", // expect error
		"op7", // expect error
		"op9", // expect error
		"bltn0", // expect error
		"method16", // private struct field
		"switch8", // expect error
		"switch9", // expect error
		"switch13", // expect error
		"switch19", // expect error
		"time0", // display time (similar to random number)
		"factor", // benchmark
		"fib", // benchmark

		"type5", // limitation with no workaround
		"type6", // limitation with no workaround

		"redeclaration0", // expect error
		"redeclaration1", // expect error
		"redeclaration2", // expect error
		"redeclaration3", // expect error
		"redeclaration4", // expect error
		"redeclaration5", // expect error
		"redeclaration-global0", // expect error
		"redeclaration-global1", // expect error
		"redeclaration-global2", // expect error
		"redeclaration-global3", // expect error
		"redeclaration-global4", // expect error
		"redeclaration-global5", // expect error
		"redeclaration-global6", // expect error
		"redeclaration-global7", // expect error
		"pkgname0", // has depedencies
		"pkgname1", // expect error
		"pkgname2", // has depedencies
		"ipp_as_key", // has depedencies
		"restricted0", // expect error
		"restricted1", // expect error
		"restricted2", // expect error
		"restricted3", // expect error
		"server6", // syntax parsing
		"server5", // syntax parsing
		"server4", // syntax parsing
		"server3", // syntax parsing
		"server2", // syntax parsing
		"server1a", // syntax parsing
		"server1", // syntax parsing
		"server0", // syntax parsing
		"server", // syntax parsing
		"rand9", // expect error

		"composite6", // invalid import
		"d3", // invalid import
		"eval0", // runs the yaegi interpreter
		"import3", // invalid import
		"import4", // invalid import
		"import5", // invalid import
		"import6", // invalid import
		"import7", // invalid import
		"import8", // invalid import
		"import9", // invalid import
		"inception", // runs the yaegi interpreter
		"tag0", // invalid import
		"var14", // invalid import
		"foo", // invalid import
		"c1", // invalid import
		"c2", // invalid import
		"d2", // invalid import
		"bar", // invalid import
		"bir", // invalid import
	], 137 + 8 - 2, yaegiOutput);
	while (true) {
		Main.update();
		for (test in tests) {
			var bool = Main.compile(test.args, test.data);
			if (!bool)
				break;
			tests.remove(test);
		}
	}
}

function test(suiteName:String, dir:String, list:Array<String>, skip:Array<String>, offset:Int, compare:Array<Array<String>> = null) {
	var count = 0;
	for (i in 0...list.length) {
		final testName = list[i];
		final compare = compare == null ? null : compare[i];
		if (skip.contains(testName))
			continue;
		final test = '$dir$testName.go';
		count++;
		tests.push({
			args: [test, path],
			data: {
				suiteName: suiteName,
				testName: testName,
				offset: i + offset,
				compare: compare,
			},
		});
		testsTotal++;
		testsLeft++;
	}
	Sys.println(suiteName + ": " + count + " queued");
}

private function close() {
	results.save();
	completionServer.close();
	// run TestData script
	TestData.main();
	Main.close();
}

private function complete(modules, data) {
	if (modules.length == 0) {
		trace("make sure to have go and yaegi cloned inside the repo for test suite access");
		throw test;
	}
	final path = Util.modulePath(modules[0]);
	final command = 'haxe -cp golibs --interp -D test extraParams.hxml -main $path';
	var proc = new sys.io.Process(command + ' --connect $completionPort');
	var code:Null<Int> = null;
	var timer = new haxe.Timer(30);
	var count = 0;
	timer.run = () -> {
		code = proc.exitCode(false);
		count++;
		if (code != null || count > 200) {
			if (code == null) {
				Sys.println("timeout... " + count);
			}
			--testsLeft;
			var result = code == 0 ? "true" : "false" + " " + code;
			if (code == 0 && data.compare != null) {
				var fail = false;
				for (i in 0...data.compare.length) {
					try {
						final line = proc.stdout.readLine();
						if (line == data.compare[i])
							continue;
					} catch (_) {}
					fail = true;
					break;
				}
				if (fail) {
					code = 3000;
					result = "naive";
				}
			}
			final current = testsTotal - testsLeft;
			var name = data.testName;
			name = StringTools.rpad(name, " ", 20);
			result = StringTools.rpad(result, " ", 9);
			Sys.println('$name $result $current/$testsTotal');
			var message = command;
			if (result == "naive") {
				message += "\n" + data.compare.join("\n");
			}
			assert(data.suiteName, data.testName, code == 0, data.offset, message);
			proc.close();
			timer.stop();
			if (testsLeft == 0) {
				close();
			}
		}
	};
}

// @formatter:off
final goList = [
    "235", // Haxe classes must start with letter charachter
    "64bit", // Haxe classes must start with letter charachter
    "alias1",
    "align",
    "append",
    "armimm",
    "atomicload", // go routines
    "bigalg", // go routines
    "bigmap",
    "blank",
    "bom",
    "chancap", //need to include more of chans built in functions for use by named types (get,set) (TODO)
    "char_lit",
    "clearfat", // not found: stdgo.Buffer.writeString
    "closedchan", // need to include more of chans built in functions for use by named types (get,set)
    "closure", // go routines
    "closure1",
    "closure2",
    "closure4", // issue with defer
    "closure7",
    "cmp", // local interfaces implement global, x.__underlying__() == y.__underlying__() interface equality
    "complit", // uses pointer.isNil() 
    "compos",
    "const", // equality comparison of AnyInterface and GoInt not implemented yet
    "const3", // fmt formatter
    "const4", // get length/cap selection through pointer
    "const7",  // not found: stdgo.Buffer
    "convert", // binary operations between number and named number type
    "convert4",
    "convT2X",
    "copy",
    "crlf",
    "ddd",
    "decl",
    "defer",
    "deferfin",
    "defernil",
    "deferprint",
    "divide",
    "divmod",
    "env",
    "escape",
    "escape3",
    "finprofiled",
    "floatcmp",
    "float_lit",
    "float_lit2",
    "for",
    "func",
    "func5", // go routine
    "func6",
    "func7",
    "func8",
    "gc",
    "gc1",
    "gcgort",
    "gcstring",
    "goprint",
    "heapsampling",
    "helloworld",
    "if",
    "indirect",
    "init1",
    "initcomma",
    "initempty",
    "initialize",
    "inline_literal",
    "intcvt",
    "int_lit",
    "iota",
    "literal",
    "literal2",
    "locklinear",
    "makeslice",
    "mallocfin",
    "map",
    "mapclear",
    "mergemul",
    "method",
    "method3",
    "method5",
    "method7",
    "named",
    "nil",
    "nilptr",
    "nilptr2",
    "nilptr_aix",
    "peano",
    "print",
    "printbig",
    "range",
    "recover",
    "recover1",
    "recover2",
    "recover3",
    "reflectmethod1",
    "reflectmethod2",
    "reflectmethod3",
    "reflectmethod4",
    "reflectmethod5",
    "reflectmethod6",
    "reflectmethod7",
    "rename",
    "reorder",
    "reorder2",
    "simassign",
    "sizeof",
    "slice3",
    "slicecap",
    "stack",
    "stackobj",
    "stackobj2",
    "stackobj3",
    "strcopy",
    "strength",
    "stringrange",
    "string_lit",
    "struct0",
    "switch",
    "tinyfin",
    "turing",
    "typeswitch",
    "typeswitch1",
    "uintptrescapes3",
    "unsafebuiltins",
    "utf",
    "varinit",
    "winbatch",
    "zerodivide",
];
final yaegiList = [
    "a1",
    "a10",
    "a11",
    "a12",
    "a13",
    "a14",
    "a15",
    "a16",
    "a17",
    "a18",
    "a19",
    "a2",
    "a20",
    "a21",
    "a22",
    "a23",
    "a24",
    "a25",
    "a26",
    "a27",
    "a28",
    "a29", // (TODO)
    "a3",
    "a30",
    "a31",
    "a32",
    "a33",
    "a34",
    "a35",
    "a36",
    "a37",
    "a38",
    "a39",
    "a4",
    "a40",
    "a41", // all errors from a41 and above are formatter fmt related
    "a42", // not found: stdgo.encoding.Binary.littleEndian.putUint64
    "a43",
    "a44",
    "a5",
    "a6",
    "a7",
    "a8",
    "a9",
    "add0",
    "add1",
    "add2",
    "addr0", // not found: stdgo.net.Http
    "addr1",
    "addr2", // not found: stdgo.encoding.Xml
    "addr3", 
    "addr4", // not found: stdgo.encoding.Json
    "addr5", // not found: stdgo.net.Url
    "alias0", // this pointer
    "alias1", // incorrect named type initalization (TODO)
    "and",
    "and0",
    "and1",
    "and2",
    "and3",
    "append0",
    "append1", // not found: stdgo.Bufio.NewScanner
    "append2", // not found: stdgo.Bufio.NewScanner
    "append3",
    "append4",
    "assert0", // not found: stdgo.Time
    "assert1", // not found: stdgo.Time
    "assign",
    "assign0", // not found: stdgo.net.Http
    "assign1", // sets a slice to nil the output is supposed to be [] 
    "assign10",
    "assign13", // formatter fmt
    "assign14",
    "assign16",
    "assign2",
    "assign3", // a,b = b,a
    "assign4", // a,b,c = c,a,b
    "assign5", // t[0], t[1] = t[1], t[0]
    "assign6", // t["a"], a["b"] = t["b"], t["a"]
    "assign7", // a, t["b"], s[1] = t["b"], s[1], a
    "assign8",
    "assign9",
    "bin", // fmt.Println Void return instead of n,err tuple (TODO)
    "bin0", // not implemented: stdgo.Strings.splitN() (TODO)
    "bin1", // not found: stdgo.Hash
    "bin2",
    "bin3", // fmt formatter
    "bin5",  // not found: stdgo.Net.TCPAddr
    "binstruct_ptr_map0", // not found: stdgo.Image
    "binstruct_ptr_slice0", // not found: stdgo.Image
    "binstruct_slice0", // not found: stdgo.Image
    "bltn",
    "bool",
    "bool0",
    "bool1",
    "bool2",
    "bool3",
    "bool4",
    "bool5",
    "build0",
    "cap0",
    "chan0", // go routines
    "chan1", // go routines
    "chan10", // go routines
    "chan2", // go routines
    "chan3", // go routines
    "chan4",
    "chan7",
    "chan8", // go routines
    "chan9", // go routines
    "cli1", // not found: stdgo.net
    "cli2", // not found: stdgo.net
    "cli3", // not found: stdgo.net
    "cli4", // not found: stdgo.net
    "cli5", // not found: stdgo.net
    "cli6", // not found: stdgo.net
    "closure0",
    "closure1",
    "closure10",
    "closure11",
    "closure12", //fmt formatter
    "closure2",
    "closure3",
    "closure4",
    "closure5",
    "closure6",
    "closure7",
    "closure8",
    "closure9",
    "comp0",
    "comp1",
    "comp2",
    "complex0",
    "complex1",
    "complex2",
    "complex3",
    "complex4",
    "composite0",
    "composite1",
    "composite10",
    "composite11",
    "composite12",
    "composite13",
    "composite14",
    "composite15",
    "composite16",
    "composite17",
    "composite2",
    "composite3",
    "composite4",
    "composite5",
    "composite6",
    "composite7",
    "composite8",
    "composite8bis",
    "composite9",
    "const0",
    "const1",
    "const10",
    "const11",
    "const12",
    "const13",
    "const14",
    "const15",
    "const16",
    "const17",
    "const18",
    "const19",
    "const2",
    "const20",
    "const21",
    "const22",
    "const23",
    "const24",
    "const3",
    "const4",
    "const5",
    "const6",
    "const7",
    "const8",
    "cont",
    "cont0",
    "cont1",
    "context", //not found: context
    "context2", //not found: context
    "convert0",
    "convert1",
    "convert2",
    "copy0",
    "copy1",
    "copy2",
    "d3",
    "defer0",
    "defer1",
    "defer2",
    "defer3",
    "defer4",
    "defer5",
    "defer6",
    "defer7",
    "defer8",
    "defer9",
    "delete0",
    "eval0",
    "export0",
    "export1",
    "fib0",
    "file_access",
    "flag0",
    "for0",
    "for1",
    "for10",
    "for11",
    "for12",
    "for13",
    "for14",
    "for15",
    "for16",
    "for2",
    "for3",
    "for4",
    "for5",
    "for6",
    "for8",
    "for9",
    "fun",
    "fun10",
    "fun11",
    "fun12",
    "fun13",
    "fun14",
    "fun15",
    "fun16",
    "fun17",
    "fun18",
    "fun19",
    "fun2",
    "fun20",
    "fun26",
    "fun3",
    "fun4",
    "fun5",
    "fun6",
    "fun7",
    "fun8",
    "fun9",
    "goto0",
    "goto1",
    "heap",
    "if",
    "if0",
    "if1",
    "if3",
    "if4",
    "if5",
    "if6",
    "if7",
    "imag0",
    "import0",
    "import1",
    "import2",
    "import3",
    "import4",
    "import5",
    "import7",
    "import8",
    "import9",
    "inc",
    "init0",
    "interface0",
    "interface1",
    "interface10",
    "interface11",
    "interface12",
    "interface13",
    "interface14",
    "interface15",
    "interface16",
    "interface17",
    "interface18",
    "interface19",
    "interface2",
    "interface20",
    "interface21",
    "interface22",
    "interface23",
    "interface24",
    "interface25",
    "interface26",
    "interface27",
    "interface28",
    "interface29",
    "interface3",
    "interface30",
    "interface31",
    "interface32",
    "interface33",
    "interface34",
    "interface35",
    "interface36",
    "interface37",
    "interface38",
    "interface39",
    "interface4",
    "interface40",
    "interface41",
    "interface42",
    "interface43",
    "interface44",
    "interface45",
    "interface46",
    "interface47",
    "interface48",
    "interface49",
    "interface5",
    "interface50",
    "interface51",
    "interface52",
    "interface6",
    "interface7",
    "interface8",
    "interface9",
    "io1",
    "iota",
    "iota0",
    "ioutil",
    "ioutil0",
    "ipp_as_key",
    "issue-1007",
    "issue-1010",
    "issue-1022",
    "issue-1052",
    "issue-1065",
    "issue-1068",
    "issue-1088",
    "issue-1089",
    "issue-1094",
    "issue-1101",
    "issue-1115",
    "issue-1126",
    "issue-1128",
    "issue-1134",
    "issue-1136",
    "issue-1145",
    "issue-1156",
    "issue-1163",
    "issue-1166",
    "issue-1167",
    "issue-1173",
    "issue-1175",
    "issue-1177",
    "issue-1179",
    "issue-1181",
    "issue-1185",
    "issue-1187",
    "issue-1189",
    "issue-1202",
    "issue-1205",
    "issue-1208",
    "issue-558",
    "issue-735",
    "issue-770",
    "issue-772",
    "issue-775",
    "issue-776",
    "issue-782",
    "issue-784",
    "issue-880",
    "issue-981",
    "issue-993",
    "l2",
    "l4",
    "len0",
    "make",
    "make0",
    "make1",
    "make2",
    "map",
    "map10",
    "map11",
    "map12",
    "map13",
    "map14",
    "map15",
    "map16",
    "map17",
    "map18",
    "map19",
    "map2",
    "map20",
    "map21",
    "map22",
    "map23",
    "map24",
    "map25",
    "map26",
    "map27",
    "map28",
    "map29",
    "map3",
    "map30",
    "map4",
    "map5",
    "map6",
    "map7",
    "map8",
    "map9",
    "math0",
    "math1",
    "math2",
    "math3",
    "method",
    "method0",
    "method1",
    "method10",
    "method11",
    "method12",
    "method13",
    "method14",
    "method15",
    "method16",
    "method17",
    "method18",
    "method19",
    "method2",
    "method20",
    "method21",
    "method22",
    "method23",
    "method24",
    "method25",
    "method26",
    "method27",
    "method28",
    "method29",
    "method3",
    "method30",
    "method31",
    "method32",
    "method33",
    "method34",
    "method35",
    "method36",
    "method37",
    "method4",
    "method5",
    "method6",
    "method7",
    "method8",
    "method9",
    "neg0",
    "new0",
    "new1",
    "new2",
    "nil0",
    "nil1",
    "nil2",
    "nil3",
    "not0",
    "not1",
    "not2",
    "num0",
    "op0",
    "op2",
    "op3",
    "op4",
    "op5",
    "op6",
    "op8",
    "opfloat32",
    "opfloat64",
    "opint16",
    "opint32",
    "opint64",
    "opint8",
    "opstring",
    "opuint16",
    "opuint32",
    "opuint64",
    "opuint8",
    "or0",
    "or1",
    "or2",
    "pkgname0",
    "pkgname2",
    "primes",
    "print0",
    "ptr0",
    "ptr1",
    "ptr2",
    "ptr3",
    "ptr4",
    "ptr5",
    "ptr5a",
    "ptr6",
    "ptr7",
    "ptr8",
    "ptr_array0",
    "ptr_array1",
    "ptr_array2",
    "ptr_array3",
    "range0",
    "range1",
    "range2",
    "range3",
    "range4",
    "range5",
    "range6",
    "range7",
    "range8",
    "real0",
    "recover0",
    "recover1",
    "recover2",
    "recover3",
    "recover4",
    "recurse0",
    "restricted0",
    "restricted1",
    "restricted2",
    "restricted3",
    "ret1",
    "ret2",
    "ret3",
    "ret4",
    "ret5",
    "ret6",
    "ret7",
    "ret8",
    "run0",
    "run1",
    "run10",
    "run11",
    "run12",
    "run13",
    "run4",
    "run5",
    "run6",
    "run7",
    "run8",
    "run9",
    "rune0",
    "rune1",
    "scope0",
    "scope1",
    "scope2",
    "scope3",
    "scope4",
    "scope5",
    "scope6",
    "scope7",
    "select0",
    "select1",
    "select10",
    "select11",
    "select12",
    "select13",
    "select14",
    "select15",
    "select2",
    "select3",
    "select4",
    "select5",
    "select6",
    "select7",
    "select8",
    "select9",
    "selector-scope0",
    "shift0",
    "shift1",
    "shift2",
    "shift3",
    "sieve",
    "slice",
    "str",
    "str0",
    "str1",
    "str2",
    "str3",
    "str4",
    "struct",
    "struct0",
    "struct0a",
    "struct1",
    "struct10",
    "struct11",
    "struct12",
    "struct13",
    "struct14",
    "struct15",
    "struct16",
    "struct17",
    "struct18",
    "struct19",
    "struct2",
    "struct20",
    "struct21",
    "struct22",
    "struct23",
    "struct24",
    "struct25",
    "struct26",
    "struct27",
    "struct28",
    "struct29",
    "struct3",
    "struct30",
    "struct31",
    "struct32",
    "struct33",
    "struct34",
    "struct35",
    "struct36",
    "struct37",
    "struct38",
    "struct39",
    "struct4",
    "struct40",
    "struct41",
    "struct42",
    "struct43",
    "struct44",
    "struct45",
    "struct46",
    "struct47",
    "struct48",
    "struct49",
    "struct5",
    "struct50",
    "struct51",
    "struct52",
    "struct53",
    "struct55",
    "struct56",
    "struct57",
    "struct58",
    "struct59",
    "struct6",
    "struct7",
    "struct8",
    "struct9",
    "switch",
    "switch0",
    "switch1",
    "switch10",
    "switch11",
    "switch12",
    "switch14",
    "switch15",
    "switch16",
    "switch17",
    "switch18",
    "switch2",
    "switch20",
    "switch21",
    "switch22",
    "switch23",
    "switch24",
    "switch25",
    "switch26",
    "switch27",
    "switch28",
    "switch29",
    "switch3",
    "switch30",
    "switch31",
    "switch32",
    "switch33",
    "switch34",
    "switch35",
    "switch36",
    "switch37",
    "switch38",
    "switch4",
    "switch5",
    "switch6",
    "switch7",
    "tag0",
    "time1",
    "time10",
    "time11",
    "time12",
    "time13",
    "time14",
    "time15",
    "time16",
    "time2",
    "time3",
    "time4",
    "time5",
    "time6",
    "time7",
    "time8",
    "time9",
    "type0",
    "type1",
    "type10",
    "type11",
    "type12",
    "type13",
    "type14",
    "type15",
    "type16",
    "type17",
    "type18",
    "type19",
    "type2",
    "type20",
    "type21",
    "type22",
    "type23",
    "type24",
    "type25",
    "type26",
    "type3",
    "type4",
    "type5",
    "type6",
    "type7",
    "type8",
    "type9",
    "unsafe0",
    "unsafe1",
    "unsafe2",
    "unsafe3",
    "unsafe4",
    "unsafe5",
    "var",
    "var10",
    "var11",
    "var12",
    "var13",
    "var14",
    "var15",
    "var2",
    "var3",
    "var4",
    "var5",
    "var6",
    "var7",
    "var8",
    "var9",
    "variadic",
    "variadic0",
    "variadic1",
    "variadic10",
    "variadic2",
    "variadic3",
    "variadic4",
    "variadic5",
    "variadic6",
    "variadic7",
    "variadic8",
    "variadic9",
];
// @formatter:on
final yaegiOutput = [
	["2", "1", "2", "3", "4"],
	["test"],
	["1", "2", "3", "4"],
	["0"],
	["0 1", "1 3", "2 5"],
	["[0 0 0 0 0 0 0 0 0 0 0 0]"],
	["[0 0 0 0 0 0 0 0 0 0 0 0]"],
	["2", "1", "2", "3", "4", "1", "2", "3", "4"],
	["[0 0] 2 7"],
	["1", "2", "3", "4"],
	["10"],
	["5", "1", "5", "3", "4"],
	["[4]"],
	["[104 101 108 108 111]", "[104 101 108 108 111 61]"],
	["1"],
	[
		"[0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31]",
		"[32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63]"
	],
	[
		"[0 0 0 0 0 0 0 0] 0",
		"[0 1 2 3 4 5 6 7] 7",
		"[0 0 0 0 0 0 0 0] 0",
		"[0 1 2 3 4 5 6 7] 7"
	],
	["[0 1 2 3 4 5 6 7]", "[0 2 4 6 8 10 12 14]"],
	["true"],
	["[hello world] [2]string"],
	["[         hello] [10]string"],
	["[zero one two] [3]string"],
	["[3 4 5 6]"],
	["ok"],
	["hello hello hello"],
	["[{}]"],
	["[1 2 3]"],
	["[1 2 3]"],
	["[1 2 3]"],
	["[1 2 3]"],
	["[1 2 3]"],
	["[0]uint8"],
	["[0]uint8 [0]uint8"],
	["[3 4]"],
	["[1 12]"],
	["true"],
	["[1 0 0 0 0 0 0 0]"],
	["[0 0 0 0 0]"],
	["32"],
	["[1 2 3 4]"],
	["[1 2 3 4 5 6]"],
	["6"],
	["[0 0]"],
	["[1]"],
	["7"],
	["7", "8", "9", "10", "11", "12", "13", "hello"],
	["7"],
	[
		"{{ null  0 0 map[] null null 0 [] false  map[] map[] null map[]   null null null null} }",
		"&{ null  0 0 map[] null null 0 [] false  map[] map[] null map[]   null null null null}"
	],
	["a: &[{1 2} {3 4}]", "x: &{3 4}"],
	[
		"null {work bob@work.com}",
		"null {work bob@work.com}",
		"null {work bob@work.com}"
	],
	["2", "2", "2"],
	[
		"0 : foo",
		"1 : bar",
		"0 : foo",
		"1 : bar",
		"0 : map[foo:foo]",
		"1 : map[bar:bar]",
		"foo : foo",
		"bar : bar"
	],
	[
		"VALUE_1",
		"VALUE_2",
		"",
		"{\"BODY_1\":\"VALUE_1\",\"BODY_2\":\"VALUE_2\",\"BODY_3\":null}",
		"[\"VALUE_1\",\"VALUE_2\",\"VALUE_3\"]"
	],
	["&{one}", "&{one}", "&{root}", "&{root}"],
	["{}"],
	["f1", "f2"],
	["f2"],
	["f2", "false"],
	["in f", "ok"],
	["true"],
	["[1 2 3]"],
	["Hello World"],
	["Hello World"],
	["[1 2 3 4]", "[1 2 5 6]"],
	["[null]"],
	[
		"TestStruct implements MyWriter",
		"11",
		"11",
		"TestStruct implements MyWriter",
		"time.Nanosecond implements MyStringer",
		"1ns",
		"1ns",
		"time.Nanosecond implements MyStringer"
	],
	[
		"1ns",
		"1ns",
		"true",
		"time.Nanosecond implements fmt.Stringer",
		"42 does not implement fmt.Stringer",
		"42 does not implement fmt.Stringer",
		"hello world",
		"hello world",
		"TestStuct implements fmt.Stringer"
	],
	["1 2"],
	["&{null null null 10s}", "&{null null null 0s}"],
	["[]"],
	["3"],
	["map[a:0.1 b:0.1 c:test]"],
	["31", "true"],
	["4"],
	["2000000001"],
	["1 2", "2 1"],
	["1 2 3", "3 1 2"],
	["[1 2]", "[2 1]"],
	["1 2", "2 1"],
	["3 2 [4 5]", "2 5 [4 3]"],
	["1"],
	["boo 4"],
	["Hello"],
	["truc"],
	["[91 170 97 228 201 185 63 63 6 130 37 11 108 248 51 27 126 230 143 216]"],
	["5"],
	["part1part2"],
	["1.1.1.1:80"],
	["(3,2) (4,5)"],
	["[(3,2) (4,5)]"],
	["[(3,2)]"],
	["Hello"],
	["false true"],
	["true"],
	["nok"],
	["nok"],
	["1"],
	["1"],
	["1"],
	["hello world"],
	["2", "2"],
	["ping"],
	["ping"],
	["success"],
	["ping"],
	["123"],
	["nok"],
	["one", "two"],
	["true"],
	["ping"],
	["Welcome to my website! /hello"],
	["Welcome to my website! /hello"],
	["Welcome to my website!"],
	["Welcome to my website!"],
	["Welcome to my website!"],
	["Welcome to my website!map[]"],
	["12"],
	["12", "15"],
	["3 0 0", "3 1 1", "3 2 2"],
	["3 0", "3 1", "3 2"],
	["3 0 i=0", "3 1 i=1", "3 2 i=2"],
	[
		"0 0", "1 -2", "3 -6", "6 -12", "10 -20", "15 -30", "21 -42", "28 -56", "36 -72", "45 -90"
	],
	["test", "9"],
	["test", "9"],
	["test", "9"],
	["test", "9"],
	["foo"],
	["5"],
	["3 0", "3 1", "3 2"],
	["true"],
	["true"],
	["false", "true"],
	["(3+2i) 3 2"],
	["complex128 (1+0i)"],
	["complex128 (2+0i)"],
	["int 2"],
	["(3+2i)"],
	["&[]"],
	["&{}"],
	["map[]"],
	["{1 1 1 1}"],
	["bb"],
	["bb"],
	["{[]}"],
	["2", "3", "[2 3]", "2", "3"],
	["map[Action:[none]]"],
	["success"],
	["&{hello}"],
	["false"],
	["false"],
	["{12}"],
	["{2}"],
	["2", "foo"],
	["1 2"],
	["1 2"],
	["[]"],
	["0 1"],
	["1 hello"],
	["16"],
	["0 4"],
	["0 2 4 6"],
	["4611686018427387904"],
	["i: 1"],
	["3"],
	["2"],
	["[1 2]"],
	["1000000000"],
	["10h0m0s"],
	["hello"],
	["9223372036854775807"],
	["2048"],
	["1"],
	["5"],
	["3"],
	["1 2 3"],
	["2 3 3"],
	["uint8", "0 2 4"],
	["32"],
	["[0 0]"],
	["2 9 4 5"],
	["5", "6", "7", "8", "9"],
	["5", "6", "7", "8", "9", "10", "11"],
	["5", "6", "7", "8", "9", "10"],
	["world"],
	["true", "world"],
	["in sort"],
	["7"],
	["7"],
	["[10 20 30 0]"],
	["[10 20 30 0]"],
	["3"],
	["test"],
	["hello", "world", "au revoir", "bye"],
	["hello", "world", "bye"],
	["hello", "world", "i: 20"],
	["hello"],
	["test"],
	["hello", "f3-end", "f3-begin", "f2-end", "f2-begin", "f1-end", "f1-begin"],
	["hello f3-end f3-begin f2-end f2-begin f1-end f1-begin"],
	["[foo bar]"],
	["map[baz:bat foo:bar]", "map[baz:bat]"],
	["foo"],
	["map[world:3]"],
	["1 2"],
	[""],
	[""],
	["3"],
	["n: 11", "b: hello world"],
	["Narg: 0"],
	["0", "1", "2", "3", "4", "5"],
	["0", "1", "2", "3", "4"],
	["bye"],
	["nok 0", "bye 0"],
	["bye"],
	["bye 0"],
	["0", "1", "bye"],
	["in f", "in loop"],
	["in for", "bye"],
	["2", "3", "4"],
	["[hellobar hellofoo worldmachin worldtruc]"],
	["0 0", "1 2", "0 0", "2 4"],
	["bye"],
	["byte 0: 228", "byte 1: 184", "byte 2: 137", "rune 0: 19977"],
	["0", "2", "3"],
	["bye"],
	["19"],
	["func() null", "nil func"],
	["ok"],
	["bye"],
	["{} null"],
	["true 2"],
	["4", "4"],
	["4"],
	["4"],
	["1"],
	["[] bar"],
	["7"],
	["[] bar"],
	["hello 3"],
	["18"],
	["ok"],
	["34"],
	["{null}"],
	["&{  null }"],
	["true"],
	["1"],
	["foo", "bar", "bye"],
	["ok"],
	["minimum: 1", "h: &[1 2 5 3]", "1 2 3 5"],
	["1"],
	["nok"],
	["bye"],
	["true", "-1"],
	["true", "-1"],
	["ok", "bye"],
	["bye"],
	["-1"],
	["2"],
	["Hello 42"],
	["Hello 42"],
	["Hello 42"],
	["init boo", "init foo", "BARR Boo"],
	["num: 2596996162"],
	["init boo", "init foo", "BARR Boo Boo22"],
	["foo-bar"],
	["in b1/foo"],
	["baz-bat"],
	["3"],
	["Hello from init 1", "Hello from init 2", "Hello from main"],
	["2", "2 truc"],
	["in", "inCall", "Hello &{foo}", "foo"],
	["hello"],
	["code: foo"],
	["in T1 truc"],
	["2"],
	["ok"],
	["ok"],
	["ok"],
	["ok"],
	["ok"],
	["null null"],
	["inCall", "Hello {foo}", "foo", "inCall", "a: {}"],
	["A"],
	["1"],
	["1"],
	["A"],
	["null"],
	["1"],
	["1"],
	["map[0:null]"],
	["[null]"],
	["true"],
	["inCall", "Hello {foo}", "foo"],
	["false"],
	["test 2"],
	["test 2"],
	["test"],
	["2 test"],
	["{test}"],
	["null"],
	["a"],
	["Hello from bar"],
	["Hello from bar"],
	["inCall", "Hello {foo}", "foo"],
	["Hello from bar"],
	["Hello from bar"],
	["0"],
	["null"],
	["1"],
	["{}"],
	["test"],
	["true", "in do"],
	["null"],
	["true"],
	["Myint: 3 3"],
	["5", "true"],
	["test"],
	["PASS"],
	["Myint: 4 4"],
	["This is an error from T: 1"],
	["hi"],
	["foo"],
	["AAAAAA"],
	["0 1 2", "0 1 2 3"],
	["0 1 2", "0 1 2 3"],
	["open __NotExisting__: no such file or directory"],
	["Go is a general-purpose language designed with systems programming in mind."],
	["Hello bar", "Hello baz"],
	["test-22"],
	["{\"num\":2} null"],
	["Ho Ho Ho!"],
	["1", "1", "2", "3", "5", "8", "13", "21", "34", "55"],
	["{1 [{0 []} {0 []}]}"],
	["hello"],
	[
		"U+65E5 '日' starts at byte position 0",
		"U+672C '本' starts at byte position 3",
		"U+8A9E '語' starts at byte position 6"
	],
	["\"2006-01-02T15:04:05.999999999Z07:00\""],
	["ab string"],
	["It's a post!"],
	["0", "1", "2", "3", "4", "Yay! I finished!"],
	["True!"],
	["1"],
	["Hello"],
	["0 EOF"],
	["true"],
	["hello"],
	["OK!"],
	["test"],
	["P-256"],
	["Hello"],
	["7"],
	["2"],
	["in F test"],
	["2 -1"],
	["1"],
	["6 6"],
	["63 21 42"],
	[
		"Hi from inline callback!",
		"Hi from asVarTest1 callback!",
		"Hi from asVarTest2 callback!",
		"Hi from struct field callback!"
	],
	["in apply", "in apply"],
	["true"],
	["test"],
	["12", "map[b:one round:12]"],
	["hello"],
	["Hello, World!!"],
	["Foo [Bar]"],
	["Hello from List!"],
	["[3 4]"],
	["foo"],
	["Hallo", "Test", "Line3"],
	["map[0:1 1:1 2:2 3:3 4:5 5:8 6:13 7:21 8:34 9:55]"],
	["0"],
	[
		"2048", "2304", "2560", "2816", "3072", "3328", "3584", "3840", "6144", "6400", "6656", "6912", "7168", "7424", "7680", "7936", "10240", "10496",
		"10752",
		"11008", "11264", "11520", "11776", "12032", "14336", "14592", "14848", "15104", "15360", "15616", "15872", "16128", "18432", "18688", "18944", "19200",
		"19456", "19712", "19968"
	],
	["6"],
	["2"],
	["h: map[]"],
	["2"],
	["map[] true"],
	["[0 0 0 0]"],
	["machin"],
	["[hellobar hellofoo worldmachin worldtruc]"],
	["[hellobar hellofoo worldmachin worldtruc]"],
	["[hellobar worldmachin]"],
	["&{ map[Accept-Encoding:[gzip]]}"],
	["true false"],
	["v:"],
	[" false", "not exists"],
	["ok"],
	["0"],
	["{map[]}"],
	["machin"],
	["true"],
	["ok"],
	["foo"],
	["ok"],
	["1 test"],
	["3"],
	["1"],
	["&{}", "&{}"],
	["13"],
	["{test 1s}"],
	["machin"],
	["hello test", "hi test", "TEST", "test"],
	["machin", "bonjour"],
	[" false", "bidule true"],
	["bidule machin"],
	["13 733"],
	["[hellobar hellofoo worldmachin worldtruc]"],
	["[hellobar hellofoo worldmachin worldtruc]"],
	["-1"],
	["ok"],
	["yes"],
	["[187 141 73 89 101 229 33 106 226 63 117 234 117 149 230 21]"],
	["25"],
	["Foo Called", "Foo Called", "Baz Called"],
	["in foo hello 3"],
	["8", "8"],
	["func", "method"],
	["25"],
	["25"],
	["25"],
	["25"],
	["&{Xproperty:value} param"],
	["minute: 4", "second: 5", "second: 5"],
	["hello"],
	["a nice error"],
	["25"],
	["hi"],
	["&{}"],
	["true"],
	["true"],
	["{null}", "&{[] {null}}"],
	["{null}", "&{[] {null}}"],
	["true"],
	["ua:"],
	["&{Hello}"],
	["true true"],
	["25"],
	["global-x"],
	["in f, c &{test}"],
	["bar"],
	["T1", "T1 ok", "T1.f()", "T1.g()", "T2", "T2 ok", "T2.f()", "T1.g()"],
	["Hello test2"],
	["here"],
	["Hello test"],
	["hello"],
	["25"],
	["Foo Called", "Foo Showed", "Foo Called", "Foo Showed", "Baz Called"],
	["in foo hello 3"],
	["in foo hello 3"],
	["0 world"],
	["25"],
	["-1"],
	["3"],
	["2"],
	["0"],
	["  null"],
	["a is nil"],
	["err is nil"],
	["false", "true", "true", "false", "Hello"],
	["-1"],
	["-1"],
	["true"],
	["1"],
	["c: 4096 uint16"],
	["a: 128 int", "b: 0 int", "c: 4096 int", "d: 1 int", "e: 0 int"],
	["a: -1.2 float64", "b: (-2-1i) complex128"],
	["2"],
	["int 0"],
	["ok"],
	["true"],
	[
		"a: 128 float32",
		"b: 0 float32",
		"c: 4096 float32",
		"d: 1 float32",
		"true",
		"true",
		"false",
		"false",
		"false"
	],
	[
		"a: 128 float64",
		"b: 0 float64",
		"c: 4096 float64",
		"d: 1 float64",
		"true",
		"true",
		"false",
		"false",
		"false"
	],
	[
		"a: 128 int16", "b: 0 int16", "c: 4096 int16", "d: 1 int16", "e: 0 int16", "true", "true", "false", "false", "true"
	],
	[
		"a: 128 int32", "b: 0 int32", "c: 4096 int32", "d: 1 int32", "e: 0 int32", "true", "true", "false", "false", "true"
	],
	[
		"a: 128 int64", "b: 0 int64", "c: 4096 int64", "d: 1 int64", "e: 0 int64", "true", "true", "false", "false", "true"
	],
	[
		"a: 12 int8", "b: 0 int8", "c: 36 int8", "d: 1 int8", "e: 0 int8", "true", "true", "false", "false", "true"
	],
	["a: hhhfff string"],
	[
		"a: 128 uint16", "b: 0 uint16", "c: 4096 uint16", "d: 1 uint16", "e: 0 uint16", "true", "true", "false", "false", "true"
	],
	[
		"a: 128 uint32", "b: 0 uint32", "c: 4096 uint32", "d: 1 uint32", "e: 0 uint32", "true", "true", "false", "false", "true"
	],
	[
		"a: 128 uint64", "b: 0 uint64", "c: 4096 uint64", "d: 1 uint64", "e: 0 uint64", "true", "true", "false", "false", "true"
	],
	[
		"a: 12 uint8", "b: 0 uint8", "c: 36 uint8", "d: 1 uint8", "e: 0 uint8", "true", "true", "false", "false", "true"
	],
	["true"],
	["true"],
	["true"],
	["Hello bar", "Hello baz"],
	["Hello bar"],
	["5"],
	["hello"],
	["2"],
	["2"],
	["5"],
	["3"],
	["5"],
	["3"],
	["3"],
	["3"],
	["{null null}"],
	["true"],
	["1"],
	["0 1", "1 2", "2 3"],
	["&[1 0]"],
	["[1 2 3]"],
	["[1 2 3 0 1 2]"],
	["[0 1 2]"],
	["[2 1 2]"],
	["ok"],
	["true", "true", "true"],
	["3"],
	["true", "true", "true"],
	["success"],
	["success"],
	["3"],
	["hello", "world", "recover: null"],
	["hello", "recover: test panic"],
	["hello", "world"],
	["hello", "null", "world"],
	["r = null", "15"],
	[
		"{[] [] map[] map[] null null null null null {[] [] map[] map[] null null null null null}}",
		"{[] [] map[] map[] null null null null null}"
	],
	["recover: log.Fatal does not exit"],
	["recover: os.Exit(1)"],
	["null restricted"],
	["recover: test log logger: restricted.go:39: test log"],
	["5"],
	["1 2"],
	["1 2"],
	["1"],
	["1 2"],
	["null"],
	["1"],
	["Everything is going wrong!", "ok"],
	["2 3"],
	["5"],
	["hello"],
	["2 3"],
	["4 5"],
	["4 5"],
	["f1 21"],
	["f1 21"],
	["f1 21"],
	["f1 21 3"],
	["f1 21 3"],
	["f1 21 3", "22"],
	[
		"a: 217 int32", "b: 11 int32", "c: 11742 int32", "d: 1 int32", "e: 11 int32", "true", "true", "false", "false", "false"
	],
	["[36 0]"],
	["1"],
	["7"],
	["1", "2", "1"],
	["2", "1"],
	["2", "3", "1"],
	["1", "2", "2"],
	["[1 2 3]", "[1 5 3]"],
	["[1 2 3]", "[6 7]"],
	["bye"],
	[
		"start for",
		"received one",
		"finish 1",
		"end for",
		"start for",
		"received #2 two true",
		"end for",
		"Bye"
	],
	["bye"],
	["nothing received", "bye"],
	["sent", "bye"],
	["bye"],
	["1", "2", "3"],
	["Bye"],
	["received from c2: hello", "received from c1: done", "Bye 1"],
	["no comm", "bye"],
	["received from c1: done", "Bye"],
	["received from c1: done", "Bye"],
	["received from c1", "Bye"],
	["received from c1: done"],
	["received from c1: done", "Bye"],
	["received from c1: done"],
	["test"],
	["4"],
	["int 255"],
	["0"],
	["8"],
	["2", "3", "5", "7", "11", "13", "17", "19", "23", "29"],
	["[0 1]"],
	["hello world"],
	["48 uint8"],
	["3"],
	["ok"],
	["true"],
	["true"],
	["7 8"],
	["0 0"],
	["0", "8"],
	["a.g.h 5"],
	["0 8"],
	["nil"],
	["{null}"],
	["0s"],
	["null"],
	["hello"],
	["foo"],
	["foo"],
	["map[] http.Header"],
	["&{[]   false }"],
	["7 8"],
	["me-test"],
	["test-me-test"],
	["child"],
	[
		"{\"Name\":\"hello\",\"Child\":[{\"Name\":\"world\",\"Child\":null}]}",
		"{\"Name\":\"hello\",\"Child\":[{\"Name\":\"world\",\"Child\":[{\"Name\":\"sunshine\",\"Child\":null}]}]}"
	],
	["true"],
	["{}"],
	["&{{[]}}"],
	["foo Boo"],
	["{{null}}"],
	["ok"],
	["7"],
	["ok"],
	["true"],
	["hello", "in F1", "true"],
	["in look", "in F1", "true"],
	["ok"],
	["true"],
	["true"],
	["true"],
	["ok"],
	["ok"],
	["5 7 64 9"],
	["ok"],
	["ok"],
	["ok"],
	["ok"],
	["ok"],
	["true"],
	["b"],
	["test"],
	["0", "01", "012"],
	["true true"],
	["7 16"],
	["{hello [{world []}]}", "{hello [{world [{sunshine []}]}]}"],
	[
		"{\"Name\":\"hello\",\"Child\":[{\"Name\":\"world\",\"Child\":[null,null]},null]}",
		"{\"Name\":\"hello\",\"Child\":[{\"Name\":\"world\",\"Child\":[{\"Name\":\"sunshine\",\"Child\":[null,null]},null]},null]}"
	],
	["{hello map[1:{world map[]}]}", "{hello map[1:{world map[1:{sunshine map[]}]}]}"],
	["{null}"],
	["test test"],
	["{\"IA\":{\"Timestamp\":0}}"],
	["{\"Timestamp\":0}"],
	["test"],
	["&{map[] map[]}"],
	["7 8"],
	["0 false"],
	["5 7 8 9"],
	["7 8"],
	["100"],
	["0", "bool false", "not nul", "bool true"],
	["not nul"],
	["string truc ok"],
	["string truc ok"],
	["i is nil"],
	["inCall", "a: {{foo}}", "inCall", "a: {}"],
	["inCall", "Hello {foo}", "foo", "inCall", "a: {}"],
	["inCall", "Hello {foo}", "foo", "inCall", "a: {}"],
	["inCall", "type Bir", "Hello {foo}", "foo", "inCall", "a: {}"],
	["inCall", "Yo {}", "inCall", "a: {}"],
	["1"],
	["bye"],
	["null"],
	["*T truc"],
	["T1"],
	["5", "bye"],
	["2", "bye"],
	["2", "1"],
	["false", "bye"],
	["true", "bye"],
	["three", "bye"],
	["100", "3"],
	["three", "bye"],
	["bye"],
	["bye 1"],
	["bye"],
	["a is []int", "b is []string", "bye"],
	["2", "bye"],
	["bye"],
	["bye"],
	[
		"m false", "a false", "x false", "- false", "a false", "g false", "e false", "= true", "2 false", "0 false"
	],
	["100", "3 foo"],
	["one"],
	["100", "3 foo"],
	["string"],
	["hello from ct1", "hello from ct3", "bye"],
	["2009-11-10 23:04:05 +0000 UTC 4"],
	["46"],
	["df: 30m0s time.Duration"],
	["24"],
	["23 4 5"],
	["0001-01-01 00:00:00 +0000 UTC"],
	["in decode"],
	["Mon Jan _2 15:04:05 2006"],
	["23 4 5"],
	["23 4 5"],
	["September"],
	["46"],
	["1985-04-12 23:20:50.52 +0000 UTC"],
	["2s"],
	["0s"],
	["300"],
	["0"],
	["hello"],
	["gzw: *gzip.Writer"],
	["[10]*sync.Pool"],
	["no name"],
	["true"],
	["{}"],
	["true"],
	["uint8 15"],
	["int32 15"],
	["2"],
	["2"],
	["2009-11-10 23:00:00 +0000 UTC"],
	["false"],
	["2009-11-10 23:04:05 +0000 UTC"],
	["foo"],
	["bye"],
	[
		"interface conversion: interface {} is int, not string",
		"interface conversion: interface {} is nil, not string",
		"interface conversion: *httptest.ResponseRecorder is not http.Pusher: missing method Push"
	],
	["some outer error", "test"],
	["some outer error", "test"],
	["Hello"],
	["int32"],
	["int"],
	["int"],
	["hello true"],
	["null"],
	["&{null}"],
	["foobar"],
	["foobar"],
	["true"],
	["[2 0 0 0 0 0 0 0 4 0 0 0 0 0 0 0]"],
	["3"],
	["24 8 16"],
	["0 0 0"],
	["hello"],
	["1 2"],
	["hello"],
	["hello world!"],
	["hello world!"],
	["3"],
	["2"],
	["2 3"],
	["2 3"],
	["a: 64 int64"],
	["in", "Hello world v1"],
	["map[]"],
	["struct"],
	["sd"],
	["[1 2 3 4]"],
	["hello []"],
	["hello [1 2 3]"],
	["test args: 1 truc", "test args: 1 truc 2"],
	["3"],
	["[1 2 3 4]", "10"],
	["foobar"],
	["true"],
	["true"],
	["test1 test2"],
	["func(...*time.Duration) string"],
	["Hello World!"],
];
